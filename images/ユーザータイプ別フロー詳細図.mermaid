graph TD
    %% ノードの定義 - 共通ページ
    Main["📋 AISample_main.php<br>メインページ"]
    List["📑 AISampleList_with_advanced.php<br>サンプル一覧"]
    View["👁️ View.php<br>サンプル詳細表示"]
    
    %% 一般ユーザーフロー
    User["👤 一般ユーザー"]
    User -->|"アクセス"| Main
    Main -->|"サンプル一覧を表示"| List
    List -->|"サンプルをクリック<br>id=X"| View
    View -->|"プロンプトをコピー"| Copy["📋 プロンプトコピー"]
    View -->|"AIサービスで使用<br>（外部リンク）"| External["🔗 外部AIサービス<br>（Gemini, GPT-4など）"]
    View -->|"関連サンプルをクリック"| View
    View -->|"一覧に戻る"| List
    Main -->|"カテゴリから探す"| Category["🏷️ Category.php"]
    Category -->|"カテゴリ別サンプル表示"| List
    Main -->|"検索"| Search["🔍 Search.php"]
    Search -->|"検索結果からサンプル選択"| View
    
    %% 登録ユーザーフロー
    RegUser["👤 登録ユーザー"]
    Login["🔑 Login.php"]
    Register["✏️ AISample_Register.php"]
    History["📜 AISample_History.php"]
    
    RegUser -->|"ログイン"| Login
    Login -->|"認証成功"| Main
    Main -->|"新規サンプル登録"| Register
    View -->|"編集ボタンクリック"| Register
    Register -->|"保存"| View
    Register -->|"キャンセル"| List
    View -->|"履歴を表示"| History
    History -->|"特定バージョンを表示"| View
    View -->|"いいね/評価"| Rating["⭐ 評価機能"]
    Rating --> View
    
    %% 管理者フロー
    Admin["👑 管理者"]
    AdminPanel["⚙️ Admin.php"]
    UserManage["👥 ユーザー管理"]
    CatManage["🏷️ カテゴリ管理"]
    SampleManage["📊 サンプル管理"]
    Stats["📈 統計・分析"]
    
    Admin -->|"管理者ログイン"| Login
    Login -->|"管理者認証"| AdminPanel
    AdminPanel -->|"ユーザー管理"| UserManage
    AdminPanel -->|"カテゴリ管理"| CatManage
    AdminPanel -->|"サンプル管理"| SampleManage
    AdminPanel -->|"統計・分析"| Stats
    SampleManage -->|"サンプル編集"| Register
    SampleManage -->|"サンプル一覧"| List
    List -->|"管理者権限で<br>サンプル削除"| SampleManage
    CatManage -->|"カテゴリ編集"| Category
    
    %% スタイル設定
    classDef userFlow fill:#dfd,stroke:#333,stroke-width:1px;
    classDef regUserFlow fill:#bbf,stroke:#333,stroke-width:1px;
    classDef adminFlow fill:#fdd,stroke:#333,stroke-width:1px;
    classDef mainPages fill:#fff,stroke:#333,stroke-width:2px;
    
    class User,Copy,External userFlow;
    class RegUser,Login,Register,History,Rating regUserFlow;
    class Admin,AdminPanel,UserManage,CatManage,SampleManage,Stats adminFlow;
    class Main,List,View,Category,Search mainPages;